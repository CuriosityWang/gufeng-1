{"version":3,"sources":["uni-app:///main.js","webpack:///D:/code/HBuilderX/gufeng/pages/editArt/editArt.vue?51bf","webpack:///D:/code/HBuilderX/gufeng/pages/editArt/editArt.vue?bdf8","webpack:///D:/code/HBuilderX/gufeng/pages/editArt/editArt.vue?3698","webpack:///D:/code/HBuilderX/gufeng/pages/editArt/editArt.vue?13ae","uni-app:///pages/editArt/editArt.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,kG;AACAA,UAAU,CAACC,gBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;;;AAGtD;AAC+K;AAC/K,gBAAgB,sLAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAgqB,CAAgB,8pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+BprB;AACA,qE;;AAEA;AACA,MADA,kBACA;AACA;AACA,eADA;AAEA,iBAFA;AAGA,sBAHA;AAIA,uBAJA;AAKA,oBALA;AAMA;AACA,sBAPA;AAQA,yBARA;AASA,uBATA;AAUA;AACA,qBAXA;AAYA,sBAZA;;AAcA,GAhBA;AAiBA;AACA,oBADA,EAjBA;;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDADA;AAEA,mBAFA;AAGA,cAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDADA;AAEA,uBAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAtBA;;AAwBA,OAzCA;;AA2CA,GAtEA;AAuEA;AACA;AACA;AACA,gBADA;AAEA,gCAFA;AAGA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,4BAFA;;AAIA;AACA;AACA;AACA;AACA,SAfA;;AAiBA,KAnBA;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAjCA;AAkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAnDA;AAoDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DADA;AAEA,wBAFA;AAGA,yEAHA;AAIA;AACA,8BADA;AAEA,4BAFA;AAGA,+BAHA;AAIA,oCAJA;AAKA,sBALA;AAMA,kDANA;AAOA,4CAPA,EAJA;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCADA;;AAGA,eAJA,EAIA,IAJA;AAKA,aAfA,MAeA;AACA;AACA;AACA,WAnCA;;;AAsCA,OA1CA,MA0CA;AACA;AACA;AACA;AACA,4CADA;AAEA,iEAFA;AAGA,sBAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAlBA;AAmBA;AACA;AACA;AACA,WAtBA;;AAwBA;;AAEA,KA7HA;;AA+HA;AACA,UAhIA,kBAgIA,GAhIA,EAgIA;AACA;AACA;AACA;AACA;AACA,KArIA,EAvEA,E","file":"pages/editArt/editArt.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/editArt/editArt.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./editArt.vue?vue&type=template&id=1fd972fa&\"\nvar renderjs\nimport script from \"./editArt.vue?vue&type=script&lang=js&\"\nexport * from \"./editArt.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/editArt/editArt.vue\"\nexport default component.exports","export * from \"-!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./editArt.vue?vue&type=template&id=1fd972fa&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./editArt.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./editArt.vue?vue&type=script&lang=js&\"","<template>\n\t <view>\n\t\t<view class=\"wrap\">\n\t\t\t<!-- 标题 -->\n\t\t\t<view class=\"write_title\">\n\t\t\t\t<input type=\"text\" v-model=\"title\" placeholder=\"请输入标题\" />\n\t\t\t</view>\n\t\t\t<!-- 输入区 -->\n\t\t\t<form @submit=\"submit\">\n\t\t\t\t<view class=\"inputArea\">\n\t\t\t\t\t<view class=\"addImg\" @tap=\"addImg\">修改首页展示图片</view>\n\t\t\t\t</view>\n\t\t\t</form>\n\t\t\t<!-- 选择分类 -->\n\t\t\t<view class=\"art-cate\">\n\t\t\t\t<view>文章分类</view>\n\t\t\t\t<view class=\"\">\n\t\t\t\t\t<picker mode=\"selector\" :range=\"caties\" @change=\"cateChange\">\n\t\t\t\t\t\t<view>{{caties[currentCateIndex]}}</view>\n\t\t\t\t\t</picker>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"editor\">\n\t\t\t<jinEdit placeholder=\"请输入内容\" @editOk=\"editOk\" uploadFileUrl=\"/#\" :html=\"real_content\"></jinEdit>\n\t\t</view>\n\t</view>\n</template>\n\n\n<script>\nvar artId, _self, loginRes; \nvar signModel = require('../../commons/sign.js');\nimport jinEdit from '../../components/jin-edit/jin-edit.vue';\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\ttitle : '',\n            artList : [],\n            inputContent : \"\",\n            needUploadImg : [],\n            uploadIndex : 0,\n            //分类\n            caties : ['点击选择'],\n            currentCateIndex : 0,\n            catiesFromApi : [],\n            // 记录真实选择的api接口数据的分类id\n            sedCateIndex  : 0,\n\t\t\treal_content: \"\",\n\t\t};\n\t},\n\tcomponents: {\n\t\tjinEdit\n\t},\n\tonLoad:function(option){\n\t\t_self = this;\n\t\tartId  = option.artId;\n\t\tsignModel.sign(this.apiServer);\n        loginRes = this.checkLogin('../my/my', '2');\n        if(!loginRes){return false;}\n\t\t// 加载要编辑的文章\n\t\tuni.request({\n            url: this.apiServer+'art&m=info&artid='+artId,\n            method: 'GET',\n            data: {},\n            success: res => {\n\t\t\t\tvar data = res.data;\n\t\t\t\tres = JSON.parse(data.slice(data.indexOf('{')));\n\t\t\t\tvar art = res.data;\n\t\t\t\t _self.artList = JSON.parse(art.art_content);\n\t\t\t\t// 文章内容转换并展示\n                var artContent = art.art_real_content;\n                _self.real_content = artContent;\n\t\t\t\t_self.real_content = _self.real_content.substring(1, _self.real_content.length-1);\n\t\t\t\t_self.real_content = _self.real_content.replace(/[\\\\]/g,'');\n\t\t\t\t// 默认值赋值\n                this.title = art.art_title;\n\t\t\t\t// 加载文章分类并设置默认值\n                uni.request({\n\t\t\t\t\turl: _self.apiServer+'category&m=index',\n                    method: 'GET',\n                    success: res => {\n\t\t\t\t\t\tvar data = res.data;\n\t\t\t\t\t\tres = JSON.parse(data.slice(data.indexOf('{')));\n\t\t\t\t\t\tvar categories = res.data;\n\t\t\t\t\t\tfor(var k in categories){\n\t\t\t\t\t\t\t_self.caties.push(categories[k]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 记录分类信息\n                        _self.catiesFromApi = categories;\n\t\t\t\t\t\t// 获取当前分类的默认值\n                        _self.sedCateIndex = art.art_cate;\n\t\t\t\t\t\t// 对应的查找picker的默认值\n\t\t\t\t\t\tvar cateName = categories[art.art_cate];\n\t\t\t\t\t\tfor(var i = 0; i < _self.caties.length; i++){\n\t\t\t\t\t\t\tif(cateName == _self.caties[i]){\n\t\t\t\t\t\t\t\t_self.currentCateIndex = i;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t},\n\tmethods: {\n\t\t\taddImg : function(){\n\t\t\t\tuni.chooseImage({\n\t\t\t\t\tcount: 9,\n\t\t\t\t\tsizeType: ['compressed'],\n\t\t\t\t\tsuccess: function(res) {\n\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\tif(res.errMsg == \"chooseImage:ok\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: \"插入成功\",\n\t\t\t\t\t\t\t\tduration: 1000\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (var i = 0; i < res.tempFilePaths.length; i++) {\n\t\t\t\t\t\t  _self.artList.push({\"type\":\"image\", \"content\" : res.tempFilePaths[i]})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tcateChange : function(e){\n\t\t\t\tvar sedIndex          = e.detail.value;\n\t\t\t\tthis.currentCateIndex = sedIndex;\n\t\t\t\t// 获取选择的分类名称\n\t\t\t\tif(sedIndex < 1){return ;}\n\t\t\t\tvar cateName = this.caties[sedIndex];\n\t\t\t\tfor(var k in this.catiesFromApi){\n\t\t\t\t\tif(cateName == this.catiesFromApi[k]){\n\t\t\t\t\t\tthis.sedCateIndex = k;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.currentCateIndex = sedIndex;\t\n\t\t\t},\t\n\t\t\tsubmitNow : function(){\n\t\t\t\t// 数据验证\n\t\t\t\tif(this.title.length < 2){uni.showToast({title:'请输入标题', icon:\"none\"}); return ;}\n\t\t\t\tif(this.sedCateIndex < 1){uni.showToast({title:'请选择分类', icon:\"none\"}); return ;}\n\t\t\t\t// 上传图片 一次一个多次上传 [ 递归函数 ]\n\t\t\t\t// 上传完成后整体提交数据\n\t\t\t\t// 首先整理一下需要上传的图片\n\t\t\t\t// this.needUploadImg = [{tmpurl : 临时地址, index : 数据索引}]\n\t\t\t\tthis.needUploadImg = [];\n\t\t\t\tfor(var i = 0; i < this.artList.length; i++){\n\t\t\t\t\tif(this.artList[i].type == 'image'){\n\t\t\t\t\t\tif(this.artList[i].content.indexOf('139.196.197.242') == -1){\n\t\t\t\t\t\t\tthis.needUploadImg.push({\"tmpurl\" : this.artList[i].content , \"indexID\" : i});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_self.uploadImg();\n\t\t\t},\n\t\t\tuploadImg : function(){\n\t\t\t\t//如果没有图片 或者已经上传完成 则执行提交\n\t\t\t\tif(this.needUploadImg.length < 1 || this.uploadIndex >=  this.needUploadImg.length){\n\t\t\t\t\t//\n\t\t\t\t\tuni.showLoading({title:\"正在提交\"});\n\t\t\t\t\tvar sign = uni.getStorageSync('sign');\n\t\t\t\t\tuni.request({\n\t\t\t\t\t\turl: this.apiServer + 'art&m=edit&artid='+artId,\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theader: {'content-type' : \"application/x-www-form-urlencoded\"},\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\ttitle   : _self.title,\n\t\t\t\t\t\t\tuid     : loginRes[0],\n\t\t\t\t\t\t\trandom  : loginRes[1],\n\t\t\t\t\t\t\tcate    : _self.sedCateIndex,\n\t\t\t\t\t\t\tsign    : sign,\n\t\t\t\t\t\t\tcontent : JSON.stringify(_self.artList),\n\t\t\t\t\t\t\treal_content: _self.real_content,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsuccess:function(res){\n\t\t\t\t\t\t\tvar data = res.data;\n\t\t\t\t\t\t\tres = JSON.parse(data.slice(data.indexOf('{')));\n\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\tif(res.status == 'ok'){\n\t\t\t\t\t\t\t\tuni.showToast({title:\"提交成功\", icon:\"none\"});\n\t\t\t\t\t\t\t\t_self.artList = [];\n\t\t\t\t\t\t\t\t// 清空数据\n\t\t\t\t\t\t\t\tsignModel.sign(_self.apiServer);\n\t\t\t\t\t\t\t\t// 防止数据缓存\n\t\t\t\t\t\t\t\t_self.currentCateIndex = 0;\n\t\t\t\t\t\t\t\t_self.sedCateIndex     = 0;\n\t\t\t\t\t\t\t\t_self.needUploadImg    = [];\n\t\t\t\t\t\t\t\t_self.title            = '';\n\t\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\t\t\t\t\turl:'../my/my'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tuni.showToast({title:\"失败啦\"});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// 上传图片\n\t\t\t\t\tuni.showLoading({title:\"上传图片\"});\n\t\t\t\t\tvar uploader = uni.uploadFile({\n\t\t\t\t\t\turl      : _self.apiServer + 'uploadimg',\n\t\t\t\t\t\tfilePath : _self.needUploadImg[_self.uploadIndex].tmpurl,\n\t\t\t\t\t\tname     : 'file',\n\t\t\t\t\t\tsuccess: (uploadFileRes) => {\n\t\t\t\t\t\t\tconsole.log(\"hhh\",uploadFileRes)\n\t\t\t\t\t\t\tvar data = uploadFileRes.data;\n\t\t\t\t\t\t\tuploadFileRes = JSON.parse(data.slice(data.indexOf('{')));\n\t\t\t\t\t\t\tif(uploadFileRes.status != 'ok'){\n\t\t\t\t\t\t\t\tuni.showToast({title:\"上传图片失败,请重试!\", icon:\"none\"});\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// 将已经上传的文件地址赋值给文章数据\n\t\t\t\t\t\t\tvar index = _self.needUploadImg[_self.uploadIndex].indexID;\n\t\t\t\t\t\t\t_self.artList[index].content = _self.staticServer + uploadFileRes.data;\n\t\t\t\t\t\t\t_self.uploadIndex ++;\n\t\t\t\t\t\t\t// 递归上传\n\t\t\t\t\t\t\tsetTimeout(function(){_self.uploadImg();}, 1000);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: (e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tuni.showToast({title:\"上传图片失败,请重试!\", icon:\"none\"});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\n\t\t\t},\n\t\t\n\t\t// 点击发布\n\t\t\teditOk(res) {\n\t\t\t\t// 提交标题 首页展示图片 以及分类信息\n\t\t\t\t_self.real_content = JSON.stringify(res.html)\n\t\t\t\tthis.submitNow();\n\t\t\t\t// 提交文章数据\n\t\t\t}\n\t\t}\n}\n</script>\n\n\n\n<style>\n\n</style>\n"],"sourceRoot":""}