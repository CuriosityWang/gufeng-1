{"version":3,"sources":["uni-app:///main.js","webpack:///D:/code/HBuilderX/gufeng/pages/write/write.vue?df73","webpack:///D:/code/HBuilderX/gufeng/pages/write/write.vue?1449","webpack:///D:/code/HBuilderX/gufeng/pages/write/write.vue?fb38","webpack:///D:/code/HBuilderX/gufeng/pages/write/write.vue?7dd1","uni-app:///pages/write/write.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,4F;AACAA,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;;;AAGpD;AAC+K;AAC/K,gBAAgB,sLAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA8pB,CAAgB,4pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACuClrB;AACA,qE;;AAEA;AACA,MADA,kBACA;AACA;AACA,iBADA;AAEA,eAFA;AAGA,iBAHA;AAIA,sBAJA;AAKA,uBALA;AAMA,oBANA;AAOA;AACA,sBARA;AASA,yBATA;AAUA,uBAVA;AAWA;AACA,qBAZA;AAaA,sBAbA;;AAeA,GAjBA;AAkBA;AACA,oBADA,EAlBA;;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CADA;AAEA,mBAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAfA;;AAiBA,GA7CA;AA8CA;AACA;AACA;AACA,gBADA;AAEA,gCAFA;AAGA;AACA;AACA,SALA;;AAOA,KATA;AAUA;AACA;AACA,gBADA;AAEA,gCAFA;AAGA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,4BAFA;;AAIA;AACA;AACA;AACA;AACA,SAfA;;AAiBA,KA5BA;AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA1CA;AA2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CADA;AAEA,gCAFA;AAGA,sBAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAZA;;AAcA;AACA;AACA,KA5EA;AA6EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CADA;AAEA,wBAFA;AAGA,yEAHA;AAIA;AACA,8BADA;AAEA,4BAFA;AAGA,+BAHA;AAIA,oCAJA;AAKA,sBALA;AAMA,kDANA;AAOA,4CAPA;AAQA,8BARA;AASA,mCATA,EAJA;;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCADA;;AAGA,eAJA,EAIA,IAJA;AAKA,aAfA,MAeA;AACA;AACA;AACA,WArCA;;;AAwCA,OA5CA,MA4CA;AACA;AACA;AACA;AACA,4CADA;AAEA,iEAFA;AAGA,sBAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAlBA;AAmBA;AACA;AACA;AACA,WAtBA;;AAwBA;;AAEA,KAxJA;;AA0JA;AACA,UA3JA,kBA2JA,GA3JA,EA2JA;AACA;AACA;AACA;AACA;AACA,KAhKA,EA9CA,E","file":"pages/write/write.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/write/write.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./write.vue?vue&type=template&id=31306246&\"\nvar renderjs\nimport script from \"./write.vue?vue&type=script&lang=js&\"\nexport * from \"./write.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/write/write.vue\"\nexport default component.exports","export * from \"-!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./write.vue?vue&type=template&id=31306246&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./write.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./write.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"wrap\">\r\n\t\t\t<!-- 标题 -->\r\n\t\t\t<view class=\"syh-icon\">\r\n\t\t\t\t<image :src=\"iconImg\" mode=\"widthFix\" @tap=\"addicon\"></image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"syh-write_title\">\r\n\t\t\t\t<input type=\"text\" v-model=\"title\" placeholder=\"请输入标题\" />\r\n\t\t\t</view>\r\n\t\t\t<view class=\"clear\"></view>\r\n\t\t\t<!-- 输入区 -->\r\n\t\t\t<form @submit=\"submit\">\r\n\t\t\t\t<view class=\"inputArea\">\r\n\t\t\t\t\t<view class=\"addImg\" @tap=\"addImg\">+首页展示图片</view>\r\n\t\t\t\t</view>\r\n\t\t\t</form>\r\n\t\t\t<view class=\"syh-write_title-2\">\r\n\t\t\t\t<view>下载地址：</view>\r\n\t\t\t\t<input type=\"text\" v-model=\"download\" placeholder=\"请输入下载地址\" />\r\n\t\t\t\t<view class=\"clear\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 选择分类 -->\r\n\t\t\t<view class=\"art-cate\">\r\n\t\t\t\t<view>文章分类</view>\r\n\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t<picker mode=\"selector\" :range=\"caties\" @change=\"cateChange\">\r\n\t\t\t\t\t\t<view>{{caties[currentCateIndex]}}</view>\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"editor\">\r\n\t\t\t<jinEdit placeholder=\"请输入内容....\" @editOk=\"editOk\" uploadFileUrl=\"/#\" html=\"  \"></jinEdit>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tvar loginRes, _self;\r\n\tvar signModel = require('../../commons/sign.js');\r\n\timport jinEdit from '../../components/jin-edit/jin-edit.vue';\r\n\texport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ticonImg : '',\r\n\t\t\ttitle : '',\r\n\t\t\tartList : [],\r\n\t\t\tinputContent : \"\",\r\n\t\t\tneedUploadImg : [],\r\n\t\t\tuploadIndex : 0,\r\n\t\t\t//分类\r\n\t\t\tcaties : ['点击选择'],\r\n\t\t\tcurrentCateIndex : 0,\r\n\t\t\tcatiesFromApi : [],\r\n\t\t\t// 记录真实选择的api接口数据的分类id\r\n\t\t\tsedCateIndex  : 0,\r\n\t\t\treal_content : \"\",\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t\tjinEdit\r\n\t},\r\n\tonLoad:function(){\r\n\t\t_self = this;\r\n\t\tthis.iconImg = \"http://139.196.197.242/imgs/wh.png\";\r\n\t\tloginRes = this.checkLogin(\"../write/write\", 2);\r\n\t\tif(!loginRes){return false;};\r\n\t\tsignModel.sign(_self.apiServer);\r\n\t\t// 加载文章分类\r\n\t\tuni.request({\r\n\t\t\turl: this.apiServer+'category&m=index',\r\n\t\t\tmethod: 'GET',\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tvar data = res.data;\r\n\t\t\t\tres = JSON.parse(data.slice(data.indexOf('{')));\r\n\t\t\t\tif(res.status == 'ok'){\r\n\t\t\t\t\t// 把数据格式整理为 picker 支持的格式 ['分类名', ...]\r\n\t\t\t\t\tvar categories = res.data;\r\n\t\t\t\t\tfor(var k in categories){\r\n\t\t\t\t\t\t_self.caties.push(categories[k]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 记录分类信息\r\n\t\t\t\t\t_self.catiesFromApi = categories;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tmethods: {\r\n\t\taddicon : function(){\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t_self.iconImg = res.tempFilePaths[0];\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\taddImg : function(){\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 9,\r\n\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tif(res.errMsg == \"chooseImage:ok\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: \"插入成功\",\r\n\t\t\t\t\t\t\tduration: 1000\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var i = 0; i < res.tempFilePaths.length; i++) {\r\n\t\t\t\t\t  _self.artList.push({\"type\":\"image\", \"content\" : res.tempFilePaths[i]})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcateChange : function(e){\r\n\t\t\tvar sedIndex          = e.detail.value;\r\n\t\t\tthis.currentCateIndex = sedIndex;\r\n\t\t\t// 获取选择的分类名称\r\n\t\t\tif(sedIndex < 1){return ;}\r\n\t\t\tvar cateName = this.caties[sedIndex];\r\n\t\t\tfor(var k in this.catiesFromApi){\r\n\t\t\t\tif(cateName == this.catiesFromApi[k]){\r\n\t\t\t\t\tthis.sedCateIndex = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.currentCateIndex = sedIndex;\t\r\n\t\t},\t\r\n\t\tsubmitNow : function(){\r\n\t\t\t// 数据验证\r\n\t\t\tif(this.title.length < 2){uni.showToast({title:'请输入标题', icon:\"none\"}); return ;}\r\n\t\t\tif(this.sedCateIndex < 1){uni.showToast({title:'请选择分类', icon:\"none\"}); return ;}\r\n\t\t\t// 上传图片 一次一个多次上传 [ 递归函数 ]\r\n\t\t\t// 上传完成后整体提交数据\r\n\t\t\t// 首先整理一下需要上传的图片\r\n\t\t\t// this.needUploadImg = [{tmpurl : 临时地址, index : 数据索引}]\r\n\t\t\tthis.needUploadImg = [];\r\n\t\t\tfor(var i = 0; i < this.artList.length; i++){\r\n\t\t\t\tif(this.artList[i].type == 'image'){\r\n\t\t\t\t\tthis.needUploadImg.push({\"tmpurl\" : this.artList[i].content , \"indexID\" : i});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.txImg != \"http://139.196.197.242/imgs/wh.png\")\r\n\t\t\t{\r\n\t\t\t\tuni.showLoading({title:\"上传icon\"});\r\n\t\t\t\tvar uploader = uni.uploadFile({\r\n\t\t\t\t\turl      : _self.apiServer + 'uploadimg',\r\n\t\t\t\t\tfilePath : this.iconImg,\r\n\t\t\t\t\tname     : 'file',\r\n\t\t\t\t\tsuccess: (uploadFileRes) => {\r\n\t\t\t\t\t\tvar data = uploadFileRes.data;\r\n\t\t\t\t\t\tuploadFileRes = JSON.parse(data.slice(data.indexOf('{')));\r\n\t\t\t\t\t\tif(uploadFileRes.status != 'ok'){\r\n\t\t\t\t\t\t\tuni.showToast({title:\"上传icon失败,请重试!\", icon:\"none\"});\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.iconImg = _self.staticServer + uploadFileRes.data;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tsetTimeout(function(){_self.uploadImg();}, 2000);\r\n\t\t},\r\n\t\tuploadImg : function(){\r\n\t\t\t//如果没有图片 或者已经上传完成 则执行提交\r\n\t\t\tif(this.needUploadImg.length < 1 || this.uploadIndex >=  this.needUploadImg.length){\r\n\t\t\t\t//\r\n\t\t\t\tuni.showLoading({title:\"正在提交\"});\r\n\t\t\t\tvar sign = uni.getStorageSync('sign');\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: this.apiServer + 'art&m=add',\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\theader: {'content-type' : \"application/x-www-form-urlencoded\"},\r\n\t\t\t\t\tdata:{\r\n\t\t\t\t\t\ttitle   : _self.title,\r\n\t\t\t\t\t\tuid     : loginRes[0],\r\n\t\t\t\t\t\trandom  : loginRes[1],\r\n\t\t\t\t\t\tcate    : _self.sedCateIndex,\r\n\t\t\t\t\t\tsign    : sign,\r\n\t\t\t\t\t\tcontent : JSON.stringify(_self.artList),\r\n\t\t\t\t\t\treal_content: _self.real_content,\r\n\t\t\t\t\t\ticon    : this.iconImg,\r\n\t\t\t\t\t\tdownload : this.download\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess:function(res){\r\n\t\t\t\t\t\tvar data = res.data;\r\n\t\t\t\t\t\tres = JSON.parse(data.slice(data.indexOf('{')));\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\tif(res.status == 'ok'){\r\n\t\t\t\t\t\t\tuni.showToast({title:\"提交成功\", icon:\"none\"});\r\n\t\t\t\t\t\t\t_self.artList = [];\r\n\t\t\t\t\t\t\t// 清空数据\r\n\t\t\t\t\t\t\tsignModel.sign(_self.apiServer);\r\n\t\t\t\t\t\t\t// 防止数据缓存\r\n\t\t\t\t\t\t\t_self.currentCateIndex = 0;\r\n\t\t\t\t\t\t\t_self.sedCateIndex     = 0;\r\n\t\t\t\t\t\t\t_self.needUploadImg    = [];\r\n\t\t\t\t\t\t\t_self.title            = '';\r\n\t\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\turl:'../my/my'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}, 2000);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tuni.showToast({title:\"失败啦\"});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t// 上传图片\r\n\t\t\t\tuni.showLoading({title:\"上传图片\"});\r\n\t\t\t\tvar uploader = uni.uploadFile({\r\n\t\t\t\t\turl      : _self.apiServer + 'uploadimg',\r\n\t\t\t\t\tfilePath : _self.needUploadImg[_self.uploadIndex].tmpurl,\r\n\t\t\t\t\tname     : 'file',\r\n\t\t\t\t\tsuccess: (uploadFileRes) => {\r\n\t\t\t\t\t\tconsole.log(\"hhh\",uploadFileRes)\r\n\t\t\t\t\t\tvar data = uploadFileRes.data;\r\n\t\t\t\t\t\tuploadFileRes = JSON.parse(data.slice(data.indexOf('{')));\r\n\t\t\t\t\t\tif(uploadFileRes.status != 'ok'){\r\n\t\t\t\t\t\t\tuni.showToast({title:\"上传图片失败,请重试!\", icon:\"none\"});\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 将已经上传的文件地址赋值给文章数据\r\n\t\t\t\t\t\tvar index = _self.needUploadImg[_self.uploadIndex].indexID;\r\n\t\t\t\t\t\t_self.artList[index].content = _self.staticServer + uploadFileRes.data;\r\n\t\t\t\t\t\t_self.uploadIndex ++;\r\n\t\t\t\t\t\t// 递归上传\r\n\t\t\t\t\t\tsetTimeout(function(){_self.uploadImg();}, 2000);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (e) => {\r\n\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\tuni.showToast({title:\"上传图片失败,请重试!\", icon:\"none\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\r\n\t\t},\r\n\t\r\n\t// 点击发布\r\n\t\teditOk(res) {\r\n\t\t\t// 提交标题 首页展示图片 以及分类信息\r\n\t\t\t_self.real_content = JSON.stringify(res.html)\r\n\t\t\tthis.submitNow();\r\n\t\t\t// 提交文章数据\r\n\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t\r\n</style>\n"],"sourceRoot":""}